<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#0a0a0f">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="cache-control" content="no-cache">
  <!-- Content Security Policy -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https:; font-src 'self' data:; frame-src 'self' https://agent-neo-flowoff.vercel.app;">
  <!-- iOS PWA -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="public/icons/icon-192x192.webp">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="manifest" href="manifest.webmanifest">
  <title>NE√ò.FLOWOFF</title>
  <link rel="stylesheet" href="styles.css?v=1.4.5">
  <link rel="stylesheet" href="glass-morphism-bottom-bar.css">
</head>
<body>
  <!-- App Shell -->
  <div id="app">


    <!-- Header simplificado com glass morphism -->
    <header class="topbar blur" id="main-header">
      <div class="header-content">
        <div class="header-logo">
          <img src="public/flowoff logo.png" alt="FlowOFF" class="header-logo-img">
        </div>
      </div>
    </header>

    <!-- Banner de instala√ß√£o PWA -->
    <div id="pwa-install-banner" class="pwa-banner">
      <div class="pwa-content">
        <div class="pwa-icon">üì±</div>
        <div class="pwa-text">
          <strong>Instale o app</strong>
          <span>Adicione √† tela inicial para acesso r√°pido</span>
        </div>
        <button id="pwa-install-btn" class="pwa-btn">Instalar</button>
        <button id="pwa-dismiss" class="pwa-dismiss">√ó</button>
      </div>
    </div>

    <!-- Conte√∫do com √°reas "rotas" -->
    <main id="router">
      <!-- HOME / HERO-PORTF√ìLIO -->
      <section class="route active" id="home">
        <div class="hero-card neon">
          
          <!-- Part√≠culas decorativas -->
          <div class="particles-container">
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
          </div>

          <!-- Conte√∫do -->
          <h1>Marketing, IA e blockchain</h1>
          <p>s·¥è ü·¥ú·¥ÑÃß·¥èÃÉ·¥ás ·¥Ö·¥á ·¥ç·¥ã·¥õ | s…™s·¥õ·¥á·¥ç·¥Äs, …™·¥Äs ·¥á ·¥°·¥á ô·¥Ä·¥ò·¥òs</p>
          <p>Do branding ao backend, da narrativa ao token ‚Äî somos a ponte entre sua vis√£o e o novo mundo digital.</p>

          <div class="cta-row">
            <a class="btn primary" href="https://wa.me/+5562983231110" target="_blank" rel="noopener">Iniciar projeto</a>
          </div>
        </div>

        <!-- Se√ß√£o FlowOFF Moderna -->
        <div class="flowoff-section">
          <div class="flowoff-card neon">
            <div class="flowoff-header">
              <div class="flowoff-logo">
                <img src="public/flowoff logo.png" alt="FlowOFF" class="flowoff-logo-img">
              </div>
              <div class="flowoff-title">
                <h2>Transformamos estrat√©gia em tecnologia.</h2>
                <span class="flowoff-subtitle">E tecnologia em resultado.</span>
              </div>
            </div>
            
            <div class="flowoff-content">
              <p class="flowoff-description">
                FlowOFF √© ag√™ncia que j√° fez gest√£o de redes sociais comum, uma solu√ß√£o que muitas empresas buscam mas n√£o sabem que uma nova estrat√©gia j√° est√° sendo usada e que poucos sabem ou possuem abordagem vision√°ria de estrat√©gias e tecnologias que fazem todo o diferencial para o rompimento das barreiras que levam aos resultados reais.
              </p>
              
              <div class="flowoff-features">
                <div class="feature-item">
                  <div class="feature-icon">üéØ</div>
                  <div class="feature-text">
                    <h4>Consultoria Estrat√©gica</h4>
                    <p>Reposicionamento, diferencia√ß√£o e estrat√©gias que realmente escalam.</p>
                  </div>
                </div>
                
                <div class="feature-item">
                  <div class="feature-icon">üìä</div>
                  <div class="feature-text">
                    <h4>Gest√£o Inteligente de Dados</h4>
                    <p>Dashboards, insights, automa√ß√µes e decis√µes guiadas por IA.</p>
                  </div>
                </div>
                
                <div class="feature-item">
                  <div class="feature-icon">üöÄ</div>
                  <div class="feature-text">
                    <h4>Tecnologias Sob Medida</h4>
                    <p>WebApps, sistemas, integra√ß√µes e tokeniza√ß√£o ‚Äî direto pro futuro.</p>
                  </div>
                </div>
              </div>
              
              <div class="flowoff-cta">
                <a href="https://wa.me/+5562983231110" target="_blank" rel="noopener" class="btn primary flowoff-btn">
                  <img src="public/mello.webp" alt="MELL√ò" class="mello-photo">
                  <span>Falar com a FLOW</span>
                  <div class="btn-shimmer"></div>
                </a>
              </div>
            </div>
          </div>
        </div>


        <div class="grid">
          <!-- mocks/prints -->
          <article class="card glow">
            <div class="thumb thumb-1">
              <img src="public/cards/taaft.com-image-generator-by-taaft-1758617772.png" alt="WebApp" class="card-image">
            </div>
            <h3>WebApp</h3>
            <p>Desenvolvimento de aplica√ß√µes web modernas e responsivas.</p>
          </article>

          <article class="card glow">
            <div class="thumb thumb-2">
              <div class="gamification-preview">
                <div class="xp-bar">
                  <div class="xp-fill"></div>
                  <span class="xp-text">Level 12</span>
                </div>
                <div class="badges-row">
                  <div class="badge-icon">üèÜ</div>
                  <div class="badge-icon">‚≠ê</div>
                  <div class="badge-icon">üéØ</div>
                </div>
                <div class="leaderboard-mini">
                  <div class="leader-item">1. Ana Silva</div>
                  <div class="leader-item">2. Jo√£o Santos</div>
                  <div class="leader-item">3. Maria Costa</div>
                </div>
              </div>
            </div>
            <h3>Dashboards Gamificados</h3>
            <p>Transforme relat√≥rios frios em experi√™ncias interativas com n√≠veis, pontos e recompensas.</p>
          </article>

          <article class="card glow">
            <div class="thumb thumb-5">
              <img src="public/cards/taaft.com-image-generator-by-taaft-1758617756.png" alt="NE√ò.FLOWOFF" class="card-image">
            </div>
            <h3>NE√ò.FLOWOFF</h3>
            <p>Laborat√≥rio de marketing, blockchain e sistemas digitais.</p>
          </article>

          <article class="card glow clickable-card" onclick="go('start')">
            <div class="thumb thumb-6">
              <img src="public/cards/taaft.com-image-generator-by-taaft-1758617737.png" alt="Entre em contato" class="card-image">
            </div>
            <h3>Entre em contato</h3>
            <p>Entre em contato para entender mais sobre como seu neg√≥cio pode avan√ßar no digital. Fale com MELL√ò‚Ñ¢</p>
          </article>
        </div>
      </section>

      <!-- PROJETOS -->
      <section class="route" id="projects">
        <div class="section-title">Projetos</div>
        <div class="list">
          <div class="list-item">
            <div>
              <h4>Site/WebApp sob medida</h4>
              <p>Performance, acessibilidade, convers√£o. Sem modinha.</p>
            </div>
            <button class="chip">ver</button>
          </div>
          <div class="list-item">
            <div>
              <h4>SAAS / BAAS</h4>
              <p>Produtos prontos ou personalizados, com integra√ß√µes.</p>
            </div>
            <button class="chip">detalhes</button>
          </div>
          <div class="list-item">
            <div>
              <h4>Integra√ß√£o cripto</h4>
              <p>Do Pix √† blockchain. Simples assim.              </p>
            </div>
            <button class="chip">ver</button>
          </div>
          <div class="list-item">
            <div>
              <h4>POST√òN</h4>
              <p>Gest√£o inteligente de redes sociais com IA e automa√ß√µes.</p>
            </div>
            <button class="chip">ver</button>
          </div>
          <div class="list-item">
            <div>
              <h4>PRO.IA</h4>
              <p>Treinamento para transformar IA em faturamento real.</p>
            </div>
            <button class="chip">ver</button>
          </div>
        </div>
      </section>

      <!-- CAPTA√á√ÉO (form) -->
      <section class="route" id="start">
        <div class="section-title">Iniciar Projeto</div>
        
        <!-- MELL√ò Profile -->
        <div class="mello-profile card glow">
          <div class="mello-image">
            <img src="public/mello.webp" alt="MELL√ò" class="mello-photo-large">
          </div>
          <div class="mello-info">
            <h3>MELL√ò‚Ñ¢</h3>
            <div class="mello-description">
              <p><strong>Agente IPFS na WEB3</strong></p>
              <p>DEV, Gestor de dados e prompts</p>
              <p>Expert em Marketing Digital e Blockchain</p>
              <p>Agencia FlowOFF¬Æ & FLOWPay¬Æ</p>
              <p class="neo-protocol">NŒû√ò Protocol</p>
              <div class="mello-divider">-</div>
            </div>
          </div>
        </div>
        
        <form id="lead-form" class="card form glow">
          <label>Nome<input name="name" color="gray" placeholder="Seu nome" autocomplete="name" required></label>
          <label>Email<input type="email" color="gray" placeholder="seuemail@exemplo.com" name="email" autocomplete="email" required></label>
          <label>WhatsApp<input name="whats" color="gray" placeholder="+55 (00) 00000-0000" autocomplete="whatsapp" required></label>
          <label>Servi√ßo que procura
            <select name="type" autocomplete="off" required>
              <option color="gray" value="" disabled selected>Selecione uma op√ß√£o</option>
              <option value="site">Site / WebApp</option>
              <option value="saas">SAAS / BAAS</option>
              <option value="cripto">Tokeniza√ß√£o / Cripto</option>
              <option value="poston">POST√òN</option>
              <option value="proia">PRO.IA</option>
            </select>
          </label>
          <button class="btn primary" type="submit">Enviar</button>
          <p class="muted center" id="lead-status"></p>
        </form>
      </section>

      <!-- ECOSSISTEMA (selos finais) -->
      <section class="route" id="ecosystem">
        <div class="section-title">Ecossistema</div>
        <div class="badges">
          <div class="badge glass">
            <img alt="FlowPay" src="public/FLOWPAY.png">
            <div><b>FlowPay</b><span>Pagamentos integrados</span></div>
          </div>
          <div class="badge glass">
            <img alt="NE√ò Protocol" src="public/neo_ico.png">
            <div><b>NE√ò Protocol</b><span>Camada tecnol√≥gica</span></div>
          </div>
          <div class="badge glass">
            <img alt="POST√òN" src="public/icon-512.png">
            <div><b>POST√òN</b><span>Gest√£o de redes sociais</span></div>
          </div>
          <div class="badge glass">
            <img alt="NE√ò.FLOWOFF" src="public/flowoff logo.png">
            <div><b>NE√ò.FLOWOFF</b><span>Assinatura criativa</span></div>
          </div>
        </div>
      </section>

      <!-- Modal lead r√°pido -->
      <dialog id="lead" class="sheet">
        <form method="dialog" class="sheet-body">
          <h3>Falar direto comigo</h3>
          <p>Respondo r√°pido. Sem burocracia.</p>
          <a class="btn primary block" href="https://wa.me/5551999999999" target="_blank" rel="noopener">WhatsApp</a>
          <button class="btn ghost block">Fechar</button>
        </form>
      </dialog>

      <!-- Modal do Agente NEO - TEMPORARIAMENTE DESABILITADO -->
      <!--
      <dialog id="agent-modal" class="sheet agent-modal">
        <div class="sheet-body">
          <div class="agent-modal-header">
            <h3>ü§ñ Agente NEO FlowOff</h3>
            <button class="agent-close" data-close="agent-modal">√ó</button>
          </div>
          <div class="agent-chat-container">
            <div id="agent-messages" class="agent-messages"></div>
            <div class="agent-input-container">
              <input type="text" id="agent-input" placeholder="Digite sua mensagem..." autocomplete="off">
              <button id="agent-send" class="agent-send-btn">Enviar</button>
            </div>
          </div>
          <div class="agent-actions">
            <button class="btn ghost small" id="agent-clear">Limpar</button>
            <button class="btn ghost small" id="agent-leads">Ver Leads</button>
          </div>
        </div>
      </dialog>
      -->


      <!-- Offline banner -->
      <div id="offline" class="offline">Sem conex√£o. Funcionalidades limitadas.</div>
    </main>

    <!-- Glass Morphism Overlay -->
    <div class="glass-morphism-overlay" id="glass-overlay"></div>

    <!-- Update Notification Banner -->
    <div id="update-banner" class="update-banner">
      <div class="update-content">
        <div class="update-icon">üîÑ</div>
        <div class="update-text">
          <strong>Nova vers√£o dispon√≠vel!</strong>
          <span>Atualize para ter acesso √†s √∫ltimas funcionalidades</span>
        </div>
        <button id="update-btn" class="update-btn">Atualizar</button>
        <button id="update-dismiss" class="update-dismiss">√ó</button>
      </div>
    </div>

    <!-- Glass Morphism Bottom Bar -->
    <nav class="glass-morphism-tabbar">
      <div class="glass-nav-item active" data-route="home">
        <div class="glass-nav-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="glass-nav-label">Home</div>
        <div class="glass-nav-indicator"></div>
      </div>
      
      <div class="glass-nav-item" data-route="projects">
        <div class="glass-nav-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22 19C22 19.5304 21.7893 20.0391 21.4142 20.4142C21.0391 20.7893 20.5304 21 20 21H4C3.46957 21 2.96086 20.7893 2.58579 20.4142C2.21071 20.0391 2 19.5304 2 19V5C2 4.46957 2.21071 3.96086 2.58579 3.58579C2.96086 3.21071 3.46957 3 4 3H20C20.5304 3 21.0391 3.21071 21.4142 3.58579C21.7893 3.96086 22 4.46957 22 5V19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8 7H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8 11H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8 15H12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="glass-nav-label">Projetos</div>
        <div class="glass-nav-indicator"></div>
      </div>
      
      <div class="glass-nav-item start-button" data-route="start">
        <div class="glass-nav-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="glass-nav-label">Iniciar</div>
        <div class="glass-nav-indicator"></div>
      </div>
      
      <div class="glass-nav-item" data-route="ecosystem">
        <div class="glass-nav-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <path d="M2 12H22" stroke="currentColor" stroke-width="2"/>
            <path d="M12 2C14.5013 4.73835 15.9228 8.29203 15.9331 12C15.9228 15.708 14.5013 19.2616 12 22C9.49872 19.2616 8.07725 15.708 8.06688 12C8.07725 8.29203 9.49872 4.73835 12 2Z" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="glass-nav-label">Ecossistema</div>
        <div class="glass-nav-indicator"></div>
      </div>
    </nav>

    <!-- Footer iOS-like -->
    <footer class="footer">
      <p class="footer-text">Ag√™ncia de Marketing na blockchain | Desenvolvimento de sistemas, WebApp's e IAs</p>
    </footer>

    <!-- Widget de Atendimento Flutuante - TEMPORARIAMENTE DESABILITADO -->
    <!-- 
    <div id="agent-widget" class="agent-widget">
      <div class="agent-widget-toggle" id="agent-widget-toggle">
        <img src="public/neo_ico.png" alt="NEO" class="agent-widget-icon">
        <span class="agent-widget-text">Atendimento</span>
      </div>
      <div class="agent-widget-popup" id="agent-widget-popup">
        <div class="agent-widget-header">
          <h4>ü§ñ Agente NEO FlowOff</h4>
          <button class="agent-widget-close" id="agent-widget-close">√ó</button>
        </div>
        <div class="agent-widget-iframe-container">
          <iframe 
            src="https://agent-neo-flowoff.vercel.app/embed" 
            width="100%" 
            height="500" 
            frameborder="0"
            style="border: none; border-radius: 10px;">
          </iframe>
        </div>
      </div>
    </div>
    -->
  </div>

  <!-- p5.js para efeitos visuais -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
<script src="p5-background.js?v=1.4.3"></script>

<!-- Integra√ß√£o API Invertexto Simplificada -->
<script src="invertexto-simple.js?v=1.0.0"></script>

<!-- Suporte WebP com Fallback -->
<script src="webp-support.js?v=1.0.0"></script>

<script src="app.js?v=1.4.3" type="module"></script>
  <script src="test-glass-morphism.js"></script>
  <script src="test-update-system.js"></script>
  <script>
    // === DETEC√á√ÉO DE DESKTOP ===
    function detectDesktop() {
      // Verificar se √© desktop baseado em v√°rias caracter√≠sticas
      const isDesktop = window.innerWidth >= 1024 && 
                       window.innerHeight >= 768 && 
                       !navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i) &&
                       !('ontouchstart' in window) &&
                       window.matchMedia('(pointer: fine)').matches;
      
      if (isDesktop) {
        // Verificar se j√° est√° na p√°gina desktop
        if (!window.location.pathname.includes('desktop.html')) {
          window.location.href = 'desktop.html';
          return true;
        }
      }
      return false;
    }

    // Executar detec√ß√£o quando a p√°gina carregar
    detectDesktop();
    
    // Force CSS reload
    const link = document.querySelector('link[href*="styles.css"]');
    if (link) {
      link.href = link.href.split('?')[0] + '?v=' + Date.now();
    }

    // PWA Install Banner
    var deferredPrompt;
    var pwaBannerShown = false;
    const pwaBanner = document.getElementById('pwa-install-banner');
    const installBtn = document.getElementById('pwa-install-btn');
    const dismissBtn = document.getElementById('pwa-dismiss');

    // Debug: Log inicial
    console.log('üîç PWA Banner Debug:');
    console.log('- Banner element:', pwaBanner);
    console.log('- Install button:', installBtn);
    console.log('- Dismiss button:', dismissBtn);
    console.log('- PWA dismissed:', localStorage.getItem('pwa-dismissed'));
    console.log('- Standalone mode:', window.matchMedia('(display-mode: standalone)').matches);

    // Verificar se j√° foi instalado ou dispensado
    if (localStorage.getItem('pwa-dismissed') === 'true' || window.matchMedia('(display-mode: standalone)').matches) {
      console.log('üö´ Banner ocultado: j√° foi dispensado ou est√° em modo standalone');
      pwaBanner.style.display = 'none';
    }

    // Escutar evento beforeinstallprompt
    window.addEventListener('beforeinstallprompt', (e) => {
      console.log('üì± PWA install prompt dispon√≠vel');
      e.preventDefault();
      deferredPrompt = e;
      
      // Mostrar banner apenas se n√£o foi dispensado
      if (localStorage.getItem('pwa-dismissed') !== 'true') {
        console.log('‚úÖ Exibindo banner PWA');
        pwaBanner.style.display = 'block';
        pwaBanner.classList.add('show');
        pwaBannerShown = true;
      } else {
        console.log('üö´ Banner n√£o exibido: j√° foi dispensado');
      }
    });

    // Fallback: Mostrar banner ap√≥s 3 segundos se n√£o foi dispensado (para teste)
    setTimeout(() => {
      if (!pwaBannerShown && localStorage.getItem('pwa-dismissed') !== 'true' && !window.matchMedia('(display-mode: standalone)').matches) {
        console.log('‚è∞ Fallback: Exibindo banner ap√≥s timeout');
        pwaBanner.style.display = 'block';
        pwaBanner.classList.add('show');
        pwaBannerShown = true;
      }
    }, 3000);

    // Bot√£o instalar
    installBtn.addEventListener('click', async () => {
      if (deferredPrompt) {
        console.log('Tentando instalar PWA...');
        try {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log('Resultado da instala√ß√£o:', outcome);
          
          if (outcome === 'accepted') {
            pwaBanner.style.display = 'none';
            pwaBanner.classList.remove('show');
            pwaBannerShown = false;
            console.log('PWA instalado com sucesso');
          }
          deferredPrompt = null;
        } catch (error) {
          console.error('Erro ao instalar PWA:', error);
        }
      }
    });

    // Bot√£o dispensar
    dismissBtn.addEventListener('click', () => {
      pwaBanner.style.display = 'none';
      pwaBanner.classList.remove('show');
      bannerShown = false;
      localStorage.setItem('pwa-dismissed', 'true');
      console.log('Banner PWA dispensado');
    });

    // Auto-hide ap√≥s 15 segundos (aumentado)
    setTimeout(() => {
      if (pwaBannerShown && pwaBanner.style.display !== 'none') {
        console.log('Auto-hiding PWA banner');
        pwaBanner.style.opacity = '0';
        setTimeout(() => {
          pwaBanner.style.display = 'none';
          pwaBanner.classList.remove('show');
          pwaBannerShown = false;
        }, 300);
      }
    }, 15000);

    // Detectar se PWA foi instalado
    window.addEventListener('appinstalled', () => {
      console.log('PWA foi instalado');
      pwaBanner.style.display = 'none';
      pwaBanner.classList.remove('show');
      bannerShown = false;
    });

    // Fun√ß√£o para testar o banner manualmente (debug)
    window.testPWAInstall = () => {
      if (pwaBanner) {
        pwaBanner.style.display = 'block';
        pwaBanner.classList.add('show');
        pwaBannerShown = true;
        console.log('Banner PWA exibido manualmente');
      }
    };

    // Fun√ß√£o para limpar o estado do banner (debug)
    window.clearPWAState = () => {
      localStorage.removeItem('pwa-dismissed');
      console.log('Estado PWA limpo');
    };

    // Efeito de blur no header durante scroll
    const header = document.getElementById('main-header');
    let lastScrollY = window.scrollY;
    let ticking = false;

    function updateHeader() {
      const scrollY = window.scrollY;
      
      if (scrollY > 50) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
      
      lastScrollY = scrollY;
      ticking = false;
    }

    function requestTick() {
      if (!ticking) {
        requestAnimationFrame(updateHeader);
        ticking = true;
      }
    }

    window.addEventListener('scroll', requestTick, { passive: true });

    // === GLASS MORPHISM OVERLAY CONTROL ===
    const glassOverlay = document.getElementById('glass-overlay');
    let overlayTicking = false;

    function updateGlassOverlay() {
      const scrollY = window.scrollY;
      const windowHeight = window.innerHeight;
      const documentHeight = document.documentElement.scrollHeight;
      
      // Calcular se deve mostrar o overlay
      const shouldShowOverlay = scrollY > 100 && (scrollY + windowHeight) < (documentHeight - 50);
      
      if (shouldShowOverlay) {
        glassOverlay.classList.add('active');
      } else {
        glassOverlay.classList.remove('active');
      }
      
      overlayTicking = false;
    }

    function requestOverlayTick() {
      if (!overlayTicking) {
        requestAnimationFrame(updateGlassOverlay);
        overlayTicking = true;
      }
    }

    window.addEventListener('scroll', requestOverlayTick, { passive: true });
    
    // Atualizar na carga inicial
    updateGlassOverlay();

    // === UPDATE DETECTION SYSTEM ===
    const updateBanner = document.getElementById('update-banner');
    const updateBtn = document.getElementById('update-btn');
    const updateDismiss = document.getElementById('update-dismiss');
    
    let updateAvailable = false;
    let updateWorker = null;
    let bannerShown = false;

    // Verificar se j√° foi dispensado
    if (localStorage.getItem('update-dismissed') === 'true') {
      console.log('üö´ Banner de atualiza√ß√£o ocultado: j√° foi dispensado');
      updateBanner.style.display = 'none';
    }

    // Detectar atualiza√ß√µes do Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        console.log('üîÑ Service Worker atualizado');
        showUpdateBanner();
      });

      // Verificar se h√° uma nova vers√£o dispon√≠vel
      navigator.serviceWorker.getRegistration().then(registration => {
        if (registration) {
          registration.addEventListener('updatefound', () => {
            console.log('üì± Nova vers√£o do Service Worker encontrada');
            const newWorker = registration.installing;
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                console.log('‚úÖ Nova vers√£o instalada! Mostrando banner de atualiza√ß√£o.');
                showUpdateBanner();
              }
            });
          });
        }
      });
    }

    // Fun√ß√£o para mostrar banner de atualiza√ß√£o
    function showUpdateBanner() {
      if (bannerShown || localStorage.getItem('update-dismissed') === 'true') {
        return;
      }
      
      console.log('üîÑ Exibindo banner de atualiza√ß√£o');
      updateBanner.style.display = 'block';
      updateBanner.classList.add('show');
      bannerShown = true;
      
      // Vibra√ß√£o se dispon√≠vel
      navigator.vibrate?.(100);
    }

    // Bot√£o atualizar
    updateBtn.addEventListener('click', () => {
      console.log('üîÑ Usu√°rio solicitou atualiza√ß√£o');
      
      // Recarregar a p√°gina para aplicar atualiza√ß√µes
      window.location.reload();
    });

    // Bot√£o dispensar
    updateDismiss.addEventListener('click', () => {
      updateBanner.style.display = 'none';
      updateBanner.classList.remove('show');
      bannerShown = false;
      localStorage.setItem('update-dismissed', 'true');
      console.log('üö´ Banner de atualiza√ß√£o dispensado');
    });

    // Auto-hide ap√≥s 10 segundos
    setTimeout(() => {
      if (bannerShown && updateBanner.style.display !== 'none') {
        console.log('‚è∞ Auto-hiding update banner');
        updateBanner.style.opacity = '0';
        setTimeout(() => {
          updateBanner.style.display = 'none';
          updateBanner.classList.remove('show');
          pwaBannerShown = false;
        }, 300);
      }
    }, 10000);

    // Fun√ß√£o para testar o banner manualmente (debug)
    window.testUpdateBanner = () => {
      if (updateBanner) {
        updateBanner.style.display = 'block';
        updateBanner.classList.add('show');
        pwaBannerShown = true;
        console.log('üîÑ Banner de atualiza√ß√£o exibido manualmente');
      }
    };

    // Fun√ß√£o para limpar o estado do banner (debug)
    window.clearUpdateState = () => {
      localStorage.removeItem('update-dismissed');
      console.log('üîÑ Estado de atualiza√ß√£o limpo');
    };

    // Verificar atualiza√ß√µes periodicamente (a cada 5 minutos)
    setInterval(() => {
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistration().then(registration => {
          if (registration) {
            registration.update();
          }
        });
      }
    }, 5 * 60 * 1000); // 5 minutos
  </script>
</body>
</html>
